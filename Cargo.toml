[workspace]
members = [
  "harmonia-client",
  # New crates from Nix.rs import (spec 001-nixrs-base)
  "harmonia-store-core",          # Core store semantics from nixrs (renamed from harmonia-store-engine)
  "harmonia-store-db",            # SQLite database for store metadata
  "harmonia-store-remote",        # Daemon client library from nixrs
  "harmonia-nar",                 # NAR archive handling from nixrs
  "harmonia-protocol",            # Daemon wire protocol from nixrs + nixrs-derive
  "harmonia-protocol-derive",     # Proc macros for protocol
  "harmonia-ssh-store",           # SSH store (optional, pending Phase 3 assessment)
  # Legacy/pending crates
  "harmonia-store-core-legacy", # (original minimal store types)
  "harmonia-store-remote-legacy", # (original daemon client - will inform harmonia-cache/daemon updates)
  "harmonia-cache", # (will be updated in Phase 3 to use new protocol)
  "harmonia-daemon", # (will be updated in Phase 3 to use new protocol)
]
resolver = "2"

[workspace.package]
version = "2.1.0"
authors = [
  "JÃ¶rg Thalheim <joerg@thalheim.io>",
  "Simon Hauser <simon.hauser@helsinki-systems.de>"
]
edition = "2024"
license = "MIT"
homepage = "https://github.com/nix-community/harmonia"
repository = "https://github.com/nix-community/harmonia.git"

[workspace.dependencies]
log = "0.4"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
tokio = { version = "1", features = ["sync", "fs", "io-util", "rt", "rt-multi-thread", "macros", "time", "net", "signal"] }
env_logger = "0.11"
anyhow = "1.0"
toml = "0.9"
thiserror = "2"
hex = "0.4"
base64 = "0.22"
ed25519-dalek = "2.1"
prometheus = { version = "0.14", default-features = false }
nix = { version = "0.30", features = ["signal"] }

# Dependencies for Nix.rs import (spec 001-nixrs-base)
bytes = "1.10"
data-encoding = "2.6"
md5 = "0.7"
num_enum = "0.7"
derive_more = { version = "2.0", features = ["display"] }
parking_lot = { version = "0.12", features = ["arc_lock"] }
pin-project-lite = "0.2"
futures = "0.3"
tokio-util = "0.7"
ring = "0.17"
once_cell = "1.19"
tracing = "0.1"
tracing-futures = "0.2"

# Proc macro dependencies for harmonia-protocol
proc-macro2 = "1.0"
quote = "1.0"
syn = "2.0"

# Dev dependencies for property-based testing
proptest = "1.6"
rstest = "0.25"
tempfile = "3.10"
test-strategy = "0.4"
pretty_assertions = "1.4"

# Database
rusqlite = { version = "0.37", features = ["bundled"] }

[workspace.lints.rust]
unsafe_code = "deny"
